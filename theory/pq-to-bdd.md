
# Символьная элиминация переменных в PQ-алгоритме

## 3. BDD и символьная элиминация

### 3.1 Что такое BDD

Бинарная диаграмма решений (BDD) — это каноническое представление булевой функции в виде направленного ациклического графа. Ключевые свойства:
- каждая булева функция имеет единственное представление при фиксированном порядке переменных;
- операции конъюнкции, дизъюнкции и отрицания выполняются эффективно с кешированием результатов;
- общие подформулы разделяются, что обеспечивает компактность представления.

### 3.2 Основная идея символьной элиминации

В случае |P| > |Q| явный перебор по вершинному покрытию становится неэффективным. Вместо этого все переменные из P элиминируются с использованием BDD.

- **Задача:** Требуется вычислить проекцию исходной булевой функции на множество Q:

F_Q(q) = ∃p_1 ... ∃p_|P| F(p, q), где p ∈ {0,1}^|P|, q ∈ {0,1}^|Q|..

Эта формула истинна на наборе q тогда и только тогда, когда существует набор p, делающий исходную формулу истинной.

### 3.3 Процесс элиминации

Переменные из P элиминируются **последовательно**, от больших индексов к малым. Такой порядок гарантирует, что к моменту обработки переменной все зависимости от неё уже учтены.

#### 3.3.1 Подготовительный этап

Для каждой переменной из P строится её определение — кофактор, выражающий её через переменные с бóльшими индексами. Эти определения формируются из клозов исходной формулы, где данная переменная является минимальной по индексу. Определение формируется автоматически и является побочным свойством алгоритма разложения pq-split

#### 3.3.2 Основной цикл

На каждом шаге:
1. Выбирается текущая переменная p_i (от самой правой в P до самой левой).
2. Собираются все кофакторы, которые зависят от p_i (содержат её в своей поддержке).
3. Строится их конъюнкция, объединяющая все ограничения, связанные с p_i.
4. Применяется операция **квантора существования** ∃p_i, которая удаляет переменную.
5. Результат сохраняется в кофакторе с наименьшим индексом среди оставшихся.
6. Все обработанные кофакторы помечаются как учтённые и больше не участвуют в дальнейших шагах.

#### 3.3.3 Завершение

После обработки всех переменных из P остаётся **единственный BDD**, зависящий только от переменных Q. Этот BDD представляет собой точную проекцию исходной формулы на подпространство Q. Это можно рассматривать как сжатие функции от n переменных до функции от |Q| переменных без потери выполнимости. 

### 3.4 Ключевые операции над BDD

В процессе элиминации используются три фундаментальные операции:

- **Конъюнкция (AND)** — объединение ограничений из разных кофакторов. Благодаря разделению общих подформул, конъюнкция не приводит к дублированию структуры, а новые узлы создаются только для уникальных комбинаций.
- **Композиция (Compose)** — замена переменной на её определение. Используется для подстановки определений одних переменных в другие.
- **Квантор существования (Exist)** — удаление переменной с сохранением всех моделей, где она может принимать любое значение. Реализуется через комбинацию кофакторов по 0 и 1 с последующей дизъюнкцией.

### 3.5 Групповая элиминация

Анализ графа зависимостей переменных позволяет выявлять ситуации, когда несколько переменных можно элиминировать **одновременно**. Критерий для включения переменной в группу:

- переменная имеет меньший индекс, чем текущая;
- все переменные, от которых она зависит, либо уже в группе, либо будут элиминированы в этом же шаге.

ВАЖНО: Групповая элиминация уменьшает число шагов и может существенно сократить размер промежуточных BDD.

---

## 4. Сложность алгоритма

### 4.1 Факторы, влияющие на сложность

Время работы символьной элиминации определяется двумя основными факторами:

1. **Число шагов элиминации** — в худшем случае равно |P|, но благодаря групповой элиминации может быть значительно меньше (вплоть до O(log(|P|)) для сильно связных структур).

2. **Размер BDD на каждом шаге** — ограничен сверху 2^|Q|, так как после удаления очередной переменной остаются только переменные из Q и ещё не элиминированные переменные из P.

### 4.2 Оценка сложности одного шага

На каждом шаге выполняются следующие операции:
- поиск кофакторов, содержащих текущую переменную — O(|P|) проверок поддержки;
- конъюнкция t кофакторов, где t — число найденных зависимостей;
- применение квантора существования к результату.

Если размер BDD на данном шаге равен S (где S ≤ 2^|Q|), то:
- конъюнкция t BDD размера S выполняется за O(t * S) с учётом кеширования;
- операция существования выполняется за O(S).

### 4.3 Общая оценка сложности

Суммируя по всем шагам: 

T = Σ (t_i · S_i)

где t_i — число кофакторов, объединённых на шаге, S_i — размер промежуточного BDD.

В типичном случае t_i убывает по мере элиминации, а S_i не превышает 2^|Q|. Поэтому:

T = O(|P| · 2^|Q|)

### 4.4 Гарантированная оценка

Так как min(|P|, |Q|) ≤ n/2, в худшем случае (когда |P| ≈ |Q| ≈ n/2) время работы не превышает:

O(n/2 · 2^(n/2)) = O(2^(n/2) · n)

---

## 5. Свойства метода

### 5.1 Полнота

Метод символьной элиминации **полон**, то есть сохраняет все модели исходной формулы. Это следует из свойств квантора существования: формула ∃p_i F истинна в точности на тех наборах остальных переменных, для которых существует значение p_i, делающее F истинной.

### 5.2 Детерминизм

Все шаги алгоритма строго определены:
- фиксированный порядок переменных;
- чёткое правило сбора зависимостей;
- детерминированные операции над BDD благодаря их каноничности.

### 5.3 Иерархичность

Порядок обработки от больших индексов к малым соответствует направлению зависимостей между переменными. Это гарантирует, что к моменту элиминации переменной все её зависимости уже учтены.

### 5.4 Модульность и кеширование

BDD-представление позволяет эффективно кешировать результаты операций. Если одна и та же подформула встречается в разных местах, в памяти хранится только один её экземпляр. Это предотвращает экспоненциальный рост при работе с повторяющимися структурами.

### 5.5 Адаптивность

Выбор между явным перебором и символьной элиминацией происходит автоматически на основе сравнения размеров P и Q. Алгоритм всегда работает с меньшим из двух множеств, что минимизирует сложность.

---

## 6. Заключение

Символьная элиминация с использованием BDD представляет собой эффективный метод работы с формулами, где вершинное покрытие P велико, но независимое множество Q остаётся достаточно малым для компактного представления. Метод обладает строгими теоретическими гарантиями и хорошо поддаётся оптимизации за счёт кеширования и групповой обработки переменных.



---

**Лицензия:** MIT
**Автор:** [Golubin Roman]  
**Год:** 2026  
